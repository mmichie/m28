# Comprehensive Dictionary Test Suite
# Tests all aspects of dictionary implementation and methods

(print "\n===== Dictionary Implementation Tests =====\n")

# =========== Section 1: Basic Dictionary Operations ===========
(print "\n--- Section 1: Basic Dictionary Operations ---")

# Test 1.1: Creating empty dictionary
(= empty-dict {})
(assert (== (len empty-dict) 0) "Empty dict has 0 length")
(print "PASS: Empty dict has 0 length")

# Test 1.2: Dictionary with string keys
(= string-dict {"name": "Alice", "age": 30})
(assert (== (get string-dict "name") "Alice") "String key access works")
(assert (== (get string-dict "age") 30) "Numeric value access works")
(print "PASS: String key dictionary works")

# Test 1.3: Dictionary with numeric keys
(= num-dict {1: "one", 2: "two", 3: "three"})
(assert (== (get num-dict 1) "one") "Numeric key access works")
(assert (== (get num-dict 2) "two") "Numeric key access works")
(print "PASS: Numeric key dictionary works")

# Test 1.4: Mixed keys and values
(= mixed-dict {1: "one", "two": 2})
(assert (== (get mixed-dict 1) "one") "Integer key access works")
(assert (== (get mixed-dict "two") 2) "String key to int value works")
(print "PASS: Mixed key dictionary works")

# Test 1.5: Nested dictionaries
(= nested-dict {"user": {"name": "Bob", "profile": {"age": 25, "city": "New York"}}})
(assert (== (get (get nested-dict "user") "name") "Bob") "Nested dict access works")
(assert (== (get (get (get nested-dict "user") "profile") "age") 25) "Deep nested dict access works")
(print "PASS: Nested dictionary works")

# =========== Section 2: Dictionary Method Tests ===========
(print "\n--- Section 2: Dictionary Method Tests ---")

# Test 2.1: Dict get method
(= user {"name": "John", "age": 30})
(assert (== (. user get "name") "John") "get basic usage works")
(assert (== (. user get "email" "unknown") "unknown") "get with default works")
(assert (== (. user get "country") None) "get missing key returns None")
(print "PASS: Dict get method works")

# Test 2.2: Dict set method
(= person {})
(. person set "name" "Sarah")
(. person set "age" 28)
(assert (== (get person "name") "Sarah") "set adds new key-value pair")
(assert (== (get person "age") 28) "set works with numeric value")
(print "PASS: Dict set method works")

# Test 2.3: Dict keys method
(= colors {"red": "#FF0000", "green": "#00FF00", "blue": "#0000FF"})
(= keys (. colors keys))
(assert (== (len keys) 3) "keys returns all keys")
(print "PASS: Dict keys method works")

# Test 2.4: Dict values method
(= values (. colors values))
(assert (== (len values) 3) "values returns all values")
(print "PASS: Dict values method works")

# Test 2.5: Dict items method
(= simple-dict {"a": 1, "b": 2})
(= items (. simple-dict items))
(assert (== (len items) 2) "items has correct length")
(print "PASS: Dict items method works")

# Test 2.6: Dict update method
(= dict1 {"a": 1, "b": 2})
(= dict2 {"b": 3, "c": 4})
(. dict1 update dict2)
(assert (== (get dict1 "b") 3) "update overwrites existing keys")
(assert (== (get dict1 "c") 4) "update adds new keys")
(assert (== (. dict1 length) 3) "update results in correct length")
(print "PASS: Dict update method works")

# Test 2.7: Dict delete method
(= del-dict {"a": 1, "b": 2, "c": 3})
(. del-dict delete "b")
(assert (== (. del-dict length) 2) "delete removes the key-value pair")
(assert (== (. del-dict get "b") None) "deleted key returns None")
(print "PASS: Dict delete method works")

# Test 2.8: Dict clear method
(= clear-dict {"a": 1, "b": 2})
(. clear-dict clear)
(assert (== (. clear-dict length) 0) "clear removes all items")
(print "PASS: Dict clear method works")

# Test 2.9: Dict contains method
(= contains-dict {"name": "test", "value": 42})
(assert (. contains-dict contains "name") "contains returns true for existing key")
(assert (not (. contains-dict contains "missing")) "contains returns false for missing key")
(print "PASS: Dict contains method works")

# =========== Section 3: Dictionary Protocol Tests ===========
(print "\n--- Section 3: Dictionary Protocol Tests ---")

# Test 3.1: Length property
(= len-dict {"a": 1, "b": 2, "c": 3})
(assert (== (. len-dict length) 3) "length property works")
(assert (== (len len-dict) 3) "len function works on dictionaries")
(print "PASS: Dict length works")

# Test 3.2: In operator
(= in-dict {"a": 1, "b": 2})
(assert (in "a" in-dict) "in operator works for existing key")
(assert (not (in "z" in-dict)) "in operator works for missing key")
(print "PASS: Dict in operator works")

# =========== Section 4: Dictionary Persistence Tests ===========
(print "\n--- Section 4: Dictionary Persistence Tests ---")

# Test 4.1: Dictionary persistence across statements
(= persist-dict {})
(. persist-dict set "count" 0)
(assert (== (get persist-dict "count") 0) "Initial value set correctly")

# Increment the counter multiple times
(. persist-dict set "count" (+ (get persist-dict "count") 1))
(. persist-dict set "count" (+ (get persist-dict "count") 1))
(. persist-dict set "count" (+ (get persist-dict "count") 1))
(assert (== (get persist-dict "count") 3) "Value persists and increments correctly")
(print "PASS: Dict persistence works")

# Test 4.2: Dictionary mutations in loops
(= counter {})
(. counter set "value" 0)
(for i in (range 10)
  (. counter set "value" (+ (get counter "value") i)))
(assert (== (get counter "value") 45) "Dictionary updates correctly in loops")
(print "PASS: Dict mutation in loops works")

# =========== Section 5: Edge Cases ===========
(print "\n--- Section 5: Edge Cases ---")

# Test 5.1: Empty dictionary operations
(= empty {})
(assert (== (. empty get "missing") None) "get on empty dict returns None")
(assert (== (. empty length) 0) "empty dict length is 0")
(print "PASS: Empty dict operations work")

# Test 5.2: Large dictionary
(= large-dict {})
(for i in (range 100)
  (. large-dict set i (* i i)))
(assert (== (. large-dict length) 100) "Large dictionary has correct length")
(assert (== (get large-dict 5) 25) "Large dictionary access works")
(print "PASS: Large dict works")

# Test 5.3: Dictionary with complex values
(= complex-dict {})
(. complex-dict set "list" [1, 2, 3])
(. complex-dict set "dict" {"nested": true})
(. complex-dict set "function" (lambda (x) (* x x)))
(assert (== (len (get complex-dict "list")) 3) "Dictionary with list value")
(assert (== (get (get complex-dict "dict") "nested") true) "Dictionary with nested dict")
(print "PASS: Dict with complex values works")

(print "\n===== Dictionary Tests Complete =====")
(print "All tests passed!")
