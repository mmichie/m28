# Test edge cases for infix operator support

(print "Testing infix edge cases...")

# Test 1: Mixed prefix and infix - infix result used in prefix context
(print (2 + 3))
(print "Mixed prefix/infix works")

# Test 2: Assignment with infix RHS
(= x (5 + 3))
(assert (== x 8) "Assignment with infix RHS")

(= y (x * 2 + 1))
(assert (== y 17) "Complex infix RHS: 8 * 2 + 1 = 17")

# Test 3: Nested infix expressions
(= result ((2 + 3) * (4 + 1)))
(assert (== result 25) "Nested infix: (2+3)*(4+1) = 25")

# Test 4: Infix in function arguments
(def add3 (a b c)
  (+ a b c))

(= result (add3 (1 + 2) (3 * 2) (10 - 5)))
(assert (== result 14) "Infix in function args: 3 + 6 + 5 = 14")

# Test 5: Comparison chains (each comparison is separate in M28)
(= x 5)
(= y 10)
(= z 15)
(assert (and (< x y) (< y z)) "Chained comparison simulation")

# Test 6: Boolean logic with infix
(= a 10)
(= b 20)
(assert (and (> a 5) (< b 30)) "Boolean and with infix comparisons")
(assert (or (< a 5) (> b 15)) "Boolean or with infix comparisons")

# Test 7: Complex precedence
(= result (2 + 3 * 4 - 1))
(assert (== result 13) "Precedence: 2 + (3*4) - 1 = 13")

(= result (10 - 2 * 3))
(assert (== result 4) "Precedence: 10 - (2*3) = 4")

# Test 8: Multiple groupings
(= result (((2 + 3) * 4) - 1))
(assert (== result 19) "Multiple parens: ((2+3)*4)-1 = 19")

# Test 9: Infix in list/tuple literals
(= nums [(1 + 1) (2 * 2) (3 ** 2)])
(assert (== nums[0] 2) "Infix in list literal [0]")
(assert (== nums[1] 4) "Infix in list literal [1]")
(assert (== nums[2] 9) "Infix in list literal [2]")

(= coords (tuple (10 + 5) (20 * 2)))
(assert (== coords[0] 15) "Infix in tuple literal [0]")
(assert (== coords[1] 40) "Infix in tuple literal [1]")

# Test 10: Infix in dict literals
(= d {"sum": (5 + 5), "product": (3 * 4)})
(assert (== d["sum"] 10) "Infix in dict value")
(assert (== d["product"] 12) "Infix in dict value")

# Test 11: Division operators
(= result (10 / 2))
(assert (== result 5.0) "Float division")

(= result (10 // 3))
(assert (== result 3) "Integer division")

(= result (10 % 3))
(assert (== result 1) "Modulo")

# Test 12: Comparison operators
(assert (< 5 10) "Less than")
(assert (<= 5 5) "Less than or equal")
(assert (> 10 5) "Greater than")
(assert (>= 5 5) "Greater than or equal")
(assert (== 5 5) "Equal")
(assert (!= 5 6) "Not equal")

# Test 13: String concatenation
(= s1 "Hello")
(= s2 "World")
(= greeting (+ s1 s2))
(print "String concat:" greeting)

# Test 14: Infix in conditional
(= x 10)
(if (> x 5)
  (print "x is greater than 5")
  (print "x is not greater than 5"))

# Test 15: Infix in while loop
(= counter 0)
(= sum 0)
(while (< counter 5)
  (= sum (+ sum counter))
  (= counter (+ counter 1)))
