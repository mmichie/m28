# Test dictionary methods

# Test get
(= d {"a": 1, "b": 2, "c": 3})
(assert (== (. d get "a") 1) "get() existing key failed")
(assert (== (. d get "z") None) "get() missing key failed")
(assert (== (. d get "z" 99) 99) "get() with default failed")

# Test keys
(= keys (. d keys))
(assert (== (len keys) 3) "keys() length failed")
# Keys might be in any order, so check contains
(assert (in "a" keys) "keys() missing 'a'")
(assert (in "b" keys) "keys() missing 'b'")
(assert (in "c" keys) "keys() missing 'c'")

# Test values
(= vals (. d values))
(assert (== (len vals) 3) "values() length failed")
# Check all values are present
(assert (in 1 vals) "values() missing 1")
(assert (in 2 vals) "values() missing 2")
(assert (in 3 vals) "values() missing 3")

# Test items
(= items (. d items))
(assert (== (len items) 3) "items() length failed")

# Test update (mutates in place)
(= d1 {"a": 1, "b": 2})
(= d2 {"b": 3, "c": 4})
(. d1 update d2)
(assert (== (. d1 get "a") 1) "update() kept existing")
(assert (== (. d1 get "b") 3) "update() overwrote")
(assert (== (. d1 get "c") 4) "update() added new")

# Test set
(= d3 {"a": 1})
(. d3 set "b" 2)
(assert (== (. d3 get "b") 2) "set() failed")

# Test delete
(= d4 {"a": 1, "b": 2})
(. d4 delete "a")
(assert (== (. d4 get "a") None) "delete() failed")
(assert (== (. d4 length) 1) "delete() should reduce length")

# Test clear (mutates in place)
(= d5 {"a": 1, "b": 2})
(. d5 clear)
(assert (== (. d5 length) 0) "clear() failed")

# Test contains
(= d6 {"a": 1, "b": 2})
(assert (. d6 contains "a") "contains() true failed")
(assert (not (. d6 contains "z")) "contains() false failed")

# Test has_key or __contains__ via 'in'
(assert (in "a" d) "'in' operator failed for existing key")
(assert (not (in "z" d)) "'in' operator failed for missing key")

(print "All dict method tests passed!")
